version: "3"
services:
  web:
    build:
      context: ./api
      dockerfile: Dockerfile
    restart: always
    ports:
     - "5001:5001"
    volumes:
      - ./api/:/home/docker/api/
    networks:
      main:
        aliases:
          - web
  redis_celery:
    image: redis
    expose:
      - "6379"
    networks:
      main:
        aliases:
          - redis_celery
  redis_leaks:
    image: redis
    expose:
      - "6379"
    networks:
      main:
        aliases:
          - redis_leaks
  worker:
    environment:
      - BATCH_SIZE_WRITE=102400
    build: celery-scheduler
    command: celery -A tasks worker -l info
    volumes:
      - ./data/:/home/docker/data/
    networks:
      main:
        aliases:
          - worker
    depends_on:
      - redis_celery
      - redis_leaks
  celery-beat:
    build: celery-scheduler
    command: celery -A tasks beat -l info
    depends_on:
      - redis_celery
      - worker
    networks:
      main:
        aliases:
          - beat
networks:
  main: